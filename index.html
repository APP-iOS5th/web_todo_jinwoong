<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        crossorigin="anonymous" />
    <title>Web Todo Jinwoong</title>
</head>

<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-6">
                <h1 class="mt-5 text-center">Todo List</h1>
                <div class="input-group mb-3 mt-3">
                    <input type="text" class="form-control" id="todoInput" placeholder="New talk" />
                    <button class="btn btn-primary" id="addTodo" onclick="onClick()">Add</button>
                </div>
                <ul class="list-group" id="todoList">
                </ul>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            loadTodos()
        });

        const createTodo = todo => {
            const itemContainerAttributes = {
                "class": "list-group-item",
            };
            const checkBoxAttributes = {
                "type": "checkbox",
                "class": "form-check-input me-1",
                "id": todo.id
            };
            const labelAttributes = {
                "class": "form-check-label stretched-link",
                "for": todo.id,
            };

            var list = document.getElementById("todoList");

            var itemContainer = document.createElement("li")
            itemContainer = configure(itemContainer, itemContainerAttributes);

            var checkBox = document.createElement("input");
            checkBox = configure(checkBox, checkBoxAttributes);

            var label = document.createElement("label");
            label = configure(label, labelAttributes);
            label.onclick = event => {
                console.log(event);
            };
            label.textContent = todo.content;

            itemContainer.appendChild(checkBox);
            itemContainer.appendChild(label);

            list.appendChild(itemContainer);
        };

        const configure = (element, attributes) => {
            Object
                .entries(attributes)
                .forEach(entry => {
                    const [key, value] = entry;
                    element.setAttribute(key, value);
                });

            return element;
        };

        const storeTodo = todo => {
            localStorage.setItem(todo.id, todo.content);
        };

        const onClick = () => {
            const content = document.getElementById("todoInput").value;
            if (content) {
                const todo = {
                    id: crypto.randomUUID(),
                    content: content,
                };

                createTodo(todo);
                storeTodo(todo);
                document.getElementById("todoInput").value = "";
            }
        };

        const loadTodos = () => {
            Object
                .keys(localStorage)
                .forEach(key => {
                    const todo = {
                        id: key,
                        content: localStorage.getItem(key),
                    };

                    createTodo(todo);
                });
        };
    </script>
</body>

</html>